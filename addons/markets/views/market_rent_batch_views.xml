<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Tree View -->
    <record id="view_market_rent_batch_tree" model="ir.ui.view">
        <field name="name">kst.market.rent.batch.tree</field>
        <field name="model">kst.market.rent.batch</field>
        <field name="arch" type="xml">
            <tree string="Rent Batches">
                <field name="collection_date"/>
                <field name="market_id"/>
                <field name="collection_type"/>
                <field name="collection_status" widget="badge"
                       decoration-success="collection_status == 'verified'"
                       decoration-warning="collection_status == 'published'"/>
                <field name="transaction_count"/>
                <field name="total_rent_expected"/>
                <field name="total_rent_paid"/>
            </tree>
        </field>
    </record>

    <!-- Form View -->
    <record id="view_market_rent_batch_form" model="ir.ui.view">
        <field name="name">kst.market.rent.batch.form</field>
        <field name="model">kst.market.rent.batch</field>
        <field name="arch" type="xml">
            <form string="Rent Batch">
                <header>
                    <button name="action_generate_transactions"
                            type="object"
                            string="Generate Transactions"
                            class="oe_highlight"
                            attrs="{'invisible': [('collection_status', '!=', 'draft')]}"
                            confirm="This will generate rent transactions for all eligible stalls in this market for the selected date and collection type. Existing transactions for the same stall and date in this batch will be skipped. Continue?"/>
                    <button name="action_publish"
                            type="object"
                            string="Publish"
                            class="oe_highlight"
                            attrs="{'invisible': [('collection_status', '!=', 'draft')]}"
                            help="Publish the rent batch for collection"/>
                    <button name="action_verify"
                            type="object"
                            string="Verify"
                            class="oe_highlight"
                            attrs="{'invisible': [('collection_status', '!=', 'published')]}"
                            help="Verify the rent batch after all collections are encoded"/>
                    <field name="collection_status" widget="statusbar" statusbar_visible="draft,published,verified"/>
                </header>
                <sheet>
                    <group>
                        <group string="Batch Information">
                            <field name="market_id"/>
                            <field name="collection_date"/>
                            <field name="collection_type"/>
                        </group>
                        <group string="Summary">
                            <field name="transaction_count" readonly="1"/>
                            <field name="total_rent_expected" readonly="1"/>
                            <field name="total_rent_paid" readonly="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Rent Transactions" name="transactions">
                            <field name="transaction_ids" nolabel="1">
                                <tree editable="bottom">
                                    <field name="transaction_date"/>
                                    <field name="stall_id"/>
                                    <field name="rent_collection_type"/>
                                    <field name="rent"/>
                                    <field name="rent_paid" sum="Total Rent Paid"/>
                                    <field name="copb_due" sum="Total COPB Due"/>
                                    <field name="copb_paid" sum="Total COPB Paid"/>
                                    <field name="receipt_number"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                    <group string="Audit Information">
                        <group>
                            <field name="create_uid" string="Created By" readonly="1"/>
                            <field name="create_date" string="Created Date" readonly="1"/>
                        </group>
                        <group>
                            <field name="write_uid" string="Modified By" readonly="1"/>
                            <field name="write_date" string="Modified Date" readonly="1"/>
                        </group>
                    </group>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Search View -->
    <record id="view_market_rent_batch_search" model="ir.ui.view">
        <field name="name">kst.market.rent.batch.search</field>
        <field name="model">kst.market.rent.batch</field>
        <field name="arch" type="xml">
            <search string="Rent Batches">
                <field name="market_id"/>
                <field name="collection_date"/>
                <field name="collection_type"/>
                <filter string="Draft" name="filter_draft" domain="[('collection_status', '=', 'draft')]"/>
                <filter string="Published" name="filter_published" domain="[('collection_status', '=', 'published')]"/>
                <filter string="Verified" name="filter_verified" domain="[('collection_status', '=', 'verified')]"/>
                <group expand="0" string="Group By">
                    <filter string="Market" name="group_market" context="{'group_by': 'market_id'}"/>
                    <filter string="Collection Date" name="group_collection_date" context="{'group_by': 'collection_date'}"/>
                    <filter string="Collection Type" name="group_collection_type" context="{'group_by': 'collection_type'}"/>
                    <filter string="Collection Status" name="group_collection_status" context="{'group_by': 'collection_status'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Action -->
    <record id="action_market_rent_batch" model="ir.actions.act_window">
        <field name="name">Rent Batches</field>
        <field name="res_model">kst.market.rent.batch</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first Rent Batch!
            </p>
            <p>
                Rent batches group daily/weekly/monthly rent collections by market and date,
                similar to the legacy DailyCollection behavior.
            </p>
        </field>
    </record>

    <!-- Menu Item (Visible to both cashiers and managers) -->
    <menuitem id="menu_market_rent_batch"
              name="Rent Batches"
              parent="menu_markets_root"
              action="action_market_rent_batch"
              sequence="12"/>
</odoo>



